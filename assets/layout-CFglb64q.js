import{u as N,j as e,a as w,r as d,s as f,S,L as _}from"./index-Bip97GBc.js";import{c as v,u as k,S as M,a as E,D as C,b as L,d as U,A as p,e as j,f as D,g as I,h as z,i as A,j as R,k as T,l as B,m as F,n as G}from"./dropdown-menu-X1h8VHe1.js";import{B as O}from"./button-DE22xxuJ.js";import{a as $}from"./avatar-co_E552q.js";/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M12 3v6",key:"1holv5"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"M12 15v6",key:"a9ows0"}]],q=v("git-commit-vertical",V);/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]],P=v("log-out",H);/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]],K=v("user-round",J);function Q(){var i,m,c,l,u,x,h,a;const{isMobile:t}=k(),{user:s,signOut:n}=N();return e.jsx(M,{children:e.jsx(E,{children:e.jsxs(C,{children:[e.jsx(L,{asChild:!0,children:e.jsxs(U,{size:"lg",className:"data-[state=open]:bg-sidebar-accent data-[state=open]:text-sidebar-accent-foreground",children:[e.jsx(p,{className:"h-8 w-8 rounded-lg grayscale",children:e.jsx(j,{src:(i=s==null?void 0:s.user_metadata)==null?void 0:i.avatar_url,alt:(m=s==null?void 0:s.user_metadata)==null?void 0:m.name})}),e.jsxs("div",{className:"grid flex-1 text-left text-sm leading-tight",children:[e.jsx("span",{className:"truncate font-medium",children:(c=s==null?void 0:s.user_metadata)==null?void 0:c.name}),e.jsx("span",{className:"text-muted-foreground truncate text-xs",children:(l=s==null?void 0:s.user_metadata)==null?void 0:l.email})]}),e.jsx(q,{className:"ml-auto size-4"})]})}),e.jsxs(D,{className:"w-(--radix-dropdown-menu-trigger-width) min-w-56 rounded-lg",side:t?"bottom":"right",align:"end",sideOffset:4,children:[e.jsx(I,{className:"p-0 font-normal",children:e.jsxs("div",{className:"flex items-center gap-2 px-1 py-1.5 text-left text-sm",children:[e.jsx(p,{className:"h-8 w-8 rounded-lg",children:e.jsx(j,{src:(u=s==null?void 0:s.user_metadata)==null?void 0:u.avatar_url,alt:(x=s==null?void 0:s.user_metadata)==null?void 0:x.name})}),e.jsxs("div",{className:"grid flex-1 text-left text-sm leading-tight",children:[e.jsx("span",{className:"truncate font-medium",children:(h=s==null?void 0:s.user_metadata)==null?void 0:h.name}),e.jsx("span",{className:"text-muted-foreground truncate text-xs",children:(a=s==null?void 0:s.user_metadata)==null?void 0:a.email})]})]})}),e.jsx(z,{}),e.jsxs(A,{onClick:n,children:[e.jsx(P,{}),"Log out"]})]})]})})})}const W=()=>{const t=w(),{user:s}=N(),[n,i]=d.useState([]),[m,c]=d.useState(!0),[l,u]=d.useState(null);d.useEffect(()=>{(async()=>{if(!s){c(!1);return}try{const{data:r,error:o}=await f.from("profiles").select("*");if(o)throw o;i(r||[])}catch(r){console.error("Error fetching users:",r),u(r instanceof Error?r.message:"Unknown error")}finally{c(!1)}})();const b=f.channel("public:profiles").on("postgres_changes",{event:"*",schema:"public",table:"profiles"},r=>{switch(r.eventType){case"INSERT":i(o=>[...o,r.new].sort((g,y)=>(g.full_name||"").localeCompare(y.full_name||"")));break;case"DELETE":i(o=>o.filter(g=>g.id!==r.old.id));break}}).subscribe();return()=>{f.removeChannel(b)}},[s]);const x=a=>{t(`/chat/${a}`)},h=()=>{t("/chat/grupo")};return m?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(S,{})}):l?e.jsxs("div",{className:"p-4 text-red-500",children:["Error: ",l,e.jsx(O,{variant:"outline",className:"ml-2",onClick:()=>window.location.reload(),children:"Reintentar"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold mt-2 flex justify-center",children:e.jsx(_,{to:"/",className:"hover:bg-muted rounded-md transition-colors p-2",children:e.jsx(K,{})})}),e.jsxs("div",{onClick:h,className:"flex items-center mt-3 ml-2 cursor-pointer hover:bg-muted rounded-md transition-colors",children:[e.jsx(p,{className:"h-8 w-8 rounded-lg",children:e.jsx(j,{src:$,alt:"grupo Familiar"})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium",children:"Grupo Familiar"})})]}),n.length<=1?e.jsx("p",{className:"text-gray-500 text-center",children:"No hay otros usuarios disponibles"}):n.filter(a=>a.id!==(s==null?void 0:s.id)).map(a=>e.jsxs("div",{onClick:()=>x(a.id),className:"flex items-center mt-3 ml-2 cursor-pointer hover:bg-muted rounded-md transition-colors",children:[e.jsx(p,{className:"h-8 w-8 rounded-lg",children:e.jsx(j,{src:a.avatar_url||"/default-avatar.png",alt:a.full_name||"Usuario"})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium",children:a.full_name||"Sin nombre"})})]},a.id))]})};function X(){const{user:t}=N();return d.useEffect(()=>{(async()=>{if(!t)return;const{error:n}=await f.from("profiles").select("*").neq("id",t.id);n&&console.error("Error fetching users:",n)})()},[t]),e.jsxs(R,{children:[e.jsx(T,{children:e.jsx(W,{})}),e.jsx(B,{children:e.jsx(Q,{})})]})}function ae({children:t}){return e.jsxs(F,{children:[e.jsx(X,{}),e.jsx(G,{children:e.jsx("div",{className:"flex flex-1 flex-col gap-4 p-4",children:t})})]})}export{ae as default};
