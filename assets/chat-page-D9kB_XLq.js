import{b,u as A,r as i,j as e,s as p,R as U}from"./index-ikBKhzlU.js";import{B as E}from"./button-Cr2Ro-QA.js";import{P as R,I as z,S as F,a as d,b as L,C as O,f as h,i as T,c as C,e as g}from"./es-CLeb64XU.js";import{T as G,p as V,q as Y,r as J,A as B,e as P,s as Q,o as W}from"./dropdown-menu-DRmMOs4H.js";import{d as X,B as Z,a as K,b as _,c as ee,M as se}from"./mode-toggle-C4G3pOhE.js";const re=()=>{const{userId:a}=b(),{user:n}=A(),[l,m]=i.useState(""),[u,c]=i.useState(!1),x=async f=>{if(f.preventDefault(),!l.trim())return;c(!0);const j=await p.from("message").insert({reciveID:a,envioID:n==null?void 0:n.id,envioUser:n,content:l,created_at:new Date().toISOString()});j.error&&console.error("Error al enviar mensaje:",j.error),m(""),c(!1)};return e.jsxs("form",{onSubmit:x,className:"flex bg-muted rounded-lg items-center px-2 gap-x-2",children:[e.jsx(G,{children:e.jsxs(V,{children:[e.jsx(Y,{asChild:!0,children:e.jsxs(E,{type:"button",size:"icon",variant:"ghost",className:"rounded-full text-muted-foreground hover:text-foreground",children:[e.jsx(R,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Adjuntar archivo"})]})}),e.jsx(J,{children:"Adjuntar archivo"})]})}),e.jsx("div",{className:"relative flex-1",children:e.jsx(z,{type:"text",placeholder:"Escribe un mensaje...",value:l,onChange:f=>m(f.target.value),className:"pr-12 py-6  bg-muted/50 border-muted focus-visible:ring-primary/20",disabled:u})}),e.jsxs(E,{type:"submit",size:"icon",disabled:u||!l.trim(),className:"rounded-full h-10 w-10 bg-primary hover:bg-primary/90",children:[e.jsx(F,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Enviar"})]})]})},ae=()=>{const{user:a}=A(),[n,l]=i.useState([]),[m,u]=i.useState(!0),{userId:c}=b(),x=U.useRef(null),f=()=>{var r;(r=x.current)==null||r.scrollIntoView({behavior:"smooth"})};i.useEffect(()=>{f()},[n]),i.useEffect(()=>{(async()=>{if(a)try{const{data:s,error:o}=await p.from("message").select("*").or(`and(reciveID.eq.${a.id},envioID.eq.${c}),and(reciveID.eq.${c},envioID.eq.${a.id})`).order("created_at",{ascending:!0});if(o){console.error("Error fetching messages:",o);return}l(s||[]),u(!1)}catch(s){console.error("Unexpected error:",s),u(!1)}})()},[a,c]),i.useEffect(()=>{if(!a)return;const r=p.channel("message").on("postgres_changes",{event:"INSERT",schema:"public",table:"message",filter:`reciveID=eq.${c}`},s=>{const o=s.new;l(t=>[...t,o])}).subscribe();return()=>{p.removeChannel(r)}},[a,c]);const j=r=>r?r.split(" ").map(s=>s[0]).join("").toUpperCase():"U",$=r=>{const s=new Date(r);return T(s)?h(s,"HH:mm",{locale:g}):C(s)?"Ayer "+h(s,"HH:mm",{locale:g}):h(s,"dd/MM/yy HH:mm",{locale:g})},k=()=>{const r={};return n.forEach(s=>{const o=new Date(s.created_at),t=h(o,"yyyy-MM-dd");r[t]||(r[t]=[]),r[t].push(s)}),r},H=r=>{const s=new Date(r);return T(s)?"Hoy":C(s)?"Ayer":h(s,"d 'de' MMMM, yyyy",{locale:g})},v=k();return m?e.jsxs("div",{className:"flex flex-col space-y-3 p-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(d,{className:"h-12 w-12 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{className:"h-4 w-[250px]"}),e.jsx(d,{className:"h-4 w-[200px]"})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{className:"h-4 w-[200px]"}),e.jsx(d,{className:"h-4 w-[150px]"})]}),e.jsx(d,{className:"h-12 w-12 rounded-full"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(d,{className:"h-12 w-12 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{className:"h-4 w-[300px]"}),e.jsx(d,{className:"h-4 w-[250px]"})]})]})]}):e.jsx("div",{className:"flex flex-col h-full bg-muted/20 rounded-lg",children:e.jsxs(L,{className:"flex-grow px-4 py-2",children:[n.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-muted-foreground py-12",children:[e.jsx("div",{className:"bg-primary/10 p-4 rounded-full mb-4",children:e.jsx(X,{className:"h-12 w-12 text-primary"})}),e.jsx("p",{className:"text-center font-medium mb-1",children:"No hay mensajes aún"}),e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"¡Comienza la conversación enviando un mensaje!"})]}):Object.keys(v).map(r=>e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-muted/50 px-3 py-1 rounded-full text-xs text-muted-foreground",children:H(r)})}),v[r].map((s,o)=>{var w,M,I,S,D;const t=s.envioID===(a==null?void 0:a.id),N=((I=(M=(w=s.envioUser)==null?void 0:w.user_metadata)==null?void 0:M.name)==null?void 0:I.split(" ")[0])??"Usuario",q=(D=(S=s.envioUser)==null?void 0:S.user_metadata)==null?void 0:D.avatar_url,y=!t&&(o===0||v[r][o-1].envioID!==s.envioID);return e.jsx("div",{className:`mb-2 ${t?"flex flex-row-reverse":"flex"}`,children:e.jsxs("div",{className:`flex ${t?"flex-row-reverse":"flex-row"} items-end gap-1 max-w-[85%] group`,children:[!t&&e.jsxs(B,{className:`h-8 w-8 border border-border ${y?"":"opacity-0 invisible"}`,children:[e.jsx(P,{src:q,alt:N}),e.jsx(Q,{children:j(N)})]}),e.jsxs("div",{className:"flex flex-col",children:[y&&!t&&e.jsx("span",{className:"text-xs font-medium text-primary ml-1 mb-0.5",children:N}),t&&e.jsx("span",{className:"text-xs font-medium text-primary ml-1 mb-0.5",children:"Tu"}),e.jsxs("div",{className:`px-3 py-2 ${t?"bg-primary text-primary-foreground rounded-tl-2xl rounded-tr-2xl rounded-bl-2xl rounded-br-sm":"bg-secondary text-secondary-foreground rounded-tl-2xl rounded-tr-2xl rounded-br-2xl rounded-bl-sm"}`,children:[e.jsx("p",{className:"break-words text-sm",children:s.content}),e.jsxs("div",{className:`flex items-center justify-end gap-1 -mb-1 mt-1 ${t?"text-primary-foreground/70":"text-secondary-foreground/70"}`,children:[e.jsx("span",{className:"text-[10px]",children:$(s.created_at)}),t&&e.jsx(O,{className:"h-3 w-3"})]})]})]})]})},s.id)})]},r)),e.jsx("div",{ref:x,className:"h-4"})]})})},te=()=>{var m;const[a,n]=i.useState(null),{userId:l}=b();return i.useEffect(()=>{(async()=>{const{data:c,error:x}=await p.from("profiles").select("*").eq("id",l).single();if(x)throw x;n(c)})()},[l]),e.jsxs("nav",{className:"flex justify-between items-center px-6",children:[e.jsx(Z,{children:e.jsxs(K,{children:[e.jsx(W,{}),e.jsx(_,{className:"hidden md:block",children:e.jsx(B,{className:"h-8 w-8 rounded-lg ",children:e.jsx(P,{src:(a==null?void 0:a.avatar_url)||"/default-avatar.png",alt:(a==null?void 0:a.full_name)||"Usuario"})})}),e.jsx(_,{children:e.jsx(ee,{children:(m=a==null?void 0:a.full_name)==null?void 0:m.split(" ")[0]})})]})}),e.jsx(se,{})]})},ie=()=>e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"sticky p-3 rounded-lg shadow-2xs border-1  bg-muted z-30 top-0",children:e.jsx(te,{})}),e.jsx(ae,{}),e.jsx("div",{className:"sticky p-3 rounded-lg shadow-2xs border-1  bg-muted z-30 bottom-0",children:e.jsx(re,{})})]})});export{ie as default};
