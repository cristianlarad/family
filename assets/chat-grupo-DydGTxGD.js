import{j as e,u as D,r as o,R,s as j}from"./index-ikBKhzlU.js";import{B as U,a as $,b as I,c as z,M as F,d as P}from"./mode-toggle-C4G3pOhE.js";import{o as q,A,e as B,s as L,T as O,p as V,q as Y,r as J}from"./dropdown-menu-DRmMOs4H.js";import{a as Q}from"./avatar-CrP0oDnr.js";import{a as l,b as W,C as X,f as x,i as T,c as E,e as f,P as Z,I as K,S as ee}from"./es-CLeb64XU.js";import{B as C}from"./button-Cr2Ro-QA.js";const se=()=>e.jsxs("nav",{className:"flex justify-between items-center px-6",children:[e.jsx(U,{children:e.jsxs($,{children:[e.jsx(q,{}),e.jsx(I,{className:"hidden md:block",children:e.jsx(A,{className:"h-8 w-8 rounded-lg ",children:e.jsx(B,{src:Q,alt:"Grupo Familiar"})})}),e.jsx(I,{children:e.jsx(z,{children:"Grupo Familiar"})})]})}),e.jsx(F,{})]}),re=()=>{const{user:t}=D(),[c,d]=o.useState([]),[u,i]=o.useState(!0),h=R.useRef(null),m=()=>{var r;(r=h.current)==null||r.scrollIntoView({behavior:"smooth"})};o.useEffect(()=>{m()},[c]),o.useEffect(()=>{(async()=>{try{const{data:s,error:n}=await j.from("message").select("*").eq("grupo",!0).order("created_at",{ascending:!0});if(n){console.error("Error fetching messages:",n);return}d(s||[]),i(!1)}catch(s){console.error("Unexpected error:",s),i(!1)}})()},[]),o.useEffect(()=>{if(!t)return;const r=j.channel("message").on("postgres_changes",{event:"INSERT",schema:"public",table:"message",filter:"grupo=eq.true"},s=>{const n=s.new;d(a=>[...a,n])}).subscribe();return()=>{j.removeChannel(r)}},[t]);const p=r=>r?r.split(" ").map(s=>s[0]).join("").toUpperCase():"U",k=r=>{const s=new Date(r);return T(s)?x(s,"HH:mm",{locale:f}):E(s)?"Ayer "+x(s,"HH:mm",{locale:f}):x(s,"dd/MM/yy HH:mm",{locale:f})},H=()=>{const r={};return c.forEach(s=>{const n=new Date(s.created_at),a=x(n,"yyyy-MM-dd");r[a]||(r[a]=[]),r[a].push(s)}),r},_=r=>{const s=new Date(r);return T(s)?"Hoy":E(s)?"Ayer":x(s,"d 'de' MMMM, yyyy",{locale:f})},g=H();return u?e.jsxs("div",{className:"flex flex-col space-y-3 p-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(l,{className:"h-12 w-12 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"h-4 w-[250px]"}),e.jsx(l,{className:"h-4 w-[200px]"})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"h-4 w-[200px]"}),e.jsx(l,{className:"h-4 w-[150px]"})]}),e.jsx(l,{className:"h-12 w-12 rounded-full"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(l,{className:"h-12 w-12 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"h-4 w-[300px]"}),e.jsx(l,{className:"h-4 w-[250px]"})]})]})]}):e.jsx("div",{className:"flex flex-col h-full bg-muted/20 rounded-lg",children:e.jsxs(W,{className:"flex-grow px-4 py-2",children:[c.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-muted-foreground py-12",children:[e.jsx("div",{className:"bg-primary/10 p-4 rounded-full mb-4",children:e.jsx(P,{className:"h-12 w-12 text-primary"})}),e.jsx("p",{className:"text-center font-medium mb-1",children:"No hay mensajes aún"}),e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"¡Comienza la conversación enviando un mensaje!"})]}):Object.keys(g).map(r=>e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-muted/50 px-3 py-1 rounded-full text-xs text-muted-foreground",children:_(r)})}),g[r].map((s,n)=>{var b,y,w,M,S;const a=s.envioID===(t==null?void 0:t.id),v=((w=(y=(b=s.envioUser)==null?void 0:b.user_metadata)==null?void 0:y.name)==null?void 0:w.split(" ")[0])??"Usuario",G=(S=(M=s.envioUser)==null?void 0:M.user_metadata)==null?void 0:S.avatar_url,N=!a&&(n===0||g[r][n-1].envioID!==s.envioID);return e.jsx("div",{className:`mb-2 ${a?"flex flex-row-reverse":"flex"}`,children:e.jsxs("div",{className:`flex ${a?"flex-row-reverse":"flex-row"} items-end gap-1 max-w-[85%] group`,children:[!a&&e.jsxs(A,{className:`h-8 w-8 border border-border ${N?"":"opacity-0 invisible"}`,children:[e.jsx(B,{src:G,alt:v}),e.jsx(L,{children:p(v)})]}),e.jsxs("div",{className:"flex flex-col",children:[N&&!a&&e.jsx("span",{className:"text-xs font-medium text-primary ml-1 mb-0.5",children:v}),a&&e.jsx("span",{className:"text-xs font-medium text-primary ml-1 mb-0.5",children:"Tu"}),e.jsxs("div",{className:`px-3 py-2 ${a?"bg-primary text-primary-foreground rounded-tl-2xl rounded-tr-2xl rounded-bl-2xl rounded-br-sm":"bg-secondary text-secondary-foreground rounded-tl-2xl rounded-tr-2xl rounded-br-2xl rounded-bl-sm"}`,children:[e.jsx("p",{className:"break-words text-sm",children:s.content}),e.jsxs("div",{className:`flex items-center justify-end gap-1 -mb-1 mt-1 ${a?"text-primary-foreground/70":"text-secondary-foreground/70"}`,children:[e.jsx("span",{className:"text-[10px]",children:k(s.created_at)}),a&&e.jsx(X,{className:"h-3 w-3"})]})]})]})]})},s.id)})]},r)),e.jsx("div",{ref:h,className:"h-4"})]})})},ae=()=>{const{user:t}=D(),[c,d]=o.useState(""),[u,i]=o.useState(!1),h=async m=>{if(m.preventDefault(),!c.trim())return;i(!0);const p=await j.from("message").insert({grupo:!0,envioID:t==null?void 0:t.id,envioUser:t,content:c,created_at:new Date().toISOString()});p.error&&console.error("Error al enviar mensaje:",p.error),d(""),i(!1)};return e.jsxs("form",{onSubmit:h,className:"flex bg-muted rounded-lg items-center px-2 gap-x-2",children:[e.jsx(O,{children:e.jsxs(V,{children:[e.jsx(Y,{asChild:!0,children:e.jsxs(C,{type:"button",size:"icon",variant:"ghost",className:"rounded-full text-muted-foreground hover:text-foreground",children:[e.jsx(Z,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Adjuntar archivo"})]})}),e.jsx(J,{children:"Adjuntar archivo"})]})}),e.jsx("div",{className:"relative flex-1",children:e.jsx(K,{type:"text",placeholder:"Escribe un mensaje...",value:c,onChange:m=>d(m.target.value),className:"pr-12 py-6  bg-muted/50 border-muted focus-visible:ring-primary/20",disabled:u})}),e.jsxs(C,{type:"submit",size:"icon",disabled:u||!c.trim(),className:"rounded-full h-10 w-10 bg-primary hover:bg-primary/90",children:[e.jsx(ee,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Enviar"})]})]})},ie=()=>e.jsx("div",{children:e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"sticky p-3 rounded-lg shadow-2xs border-1  bg-muted z-30 top-0",children:e.jsx(se,{})}),e.jsx(re,{}),e.jsx("div",{className:"sticky p-3 rounded-lg shadow-2xs border-1  bg-muted z-30 bottom-0",children:e.jsx(ae,{})})]})})});export{ie as default};
